<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<!-- 
	Mapping file autogenerated by MyEclipse - Hibernate Tools
-->
<hibernate-mapping package="com.mangocity.hotel.base.persistence" default-lazy="false">
	<class name="HtlQuota" table="htl_quota" 
		dynamic-insert="true" dynamic-update="true">

		<id name="ID" column="QUOTA_ID">
			<generator class="sequence">
				<param name="sequence">seq_hotel_quota</param>
			</generator>
		</id>
		<property name="quotaBatchId" column="quota_Batch_Id"></property>		
		<property name="quotaType" column="QUOTA_TYPE"></property>
		<property name="quotaPattern" column="quota_pattern"></property>
		<property name="hotelId" column="HOTEL_ID"></property>
		<property name="contractId" column="CONTRACT_ID"></property>
		<property name="ableSaleDate" column="ABLE_SALE_DATE"></property>
		<property name="week" column="week"></property>
		<property name="totalQty" column="total_Qty"></property>
		<property name="ableQty" column="ABLE_QTY"></property>
		<property name="freeQty" column="FREE_QTY"></property>
		<property name="privateQty" column="private_qty"></property>
		<property name="usedQty" column="USED_QTY"></property>
		<property name="availQty" column="avail_qty"></property>
		<property name="shareQty" column="SHARE_QTY"></property>
		<property name="shareType" column="share_type"></property>
		<property name="takebackQuota" column="takeback_Quota"></property>
		<many-to-one name="room" class="HtlRoom" column="room_id"></many-to-one>
        <bag name="lstCutOffDay"  cascade="all-delete-orphan" order-by="CUTOFF_DAY DESC">
        	<key >
        		<column name="quota_id"></column>
        	</key>
        	<one-to-many class = "HtlCutoffDayQuota"/>
        </bag>
        <bag name="lstAssign" cascade="all-delete-orphan" order-by="member_Type asc">
        	<key>
        		<column name="quota_id"></column>
        	</key>
        	<one-to-many class = "HtlAssignCustom"/>
        </bag>
	</class>
	
	<query name="findQuotaByBizKey">
		<![CDATA[ 
			from HtlQuota quota where quota.quotaType = ? and quota.shareType=?
			  and quota.hotelId = ? and quota.contractId =?
			  and ableSaleDate =?
		]]>
	</query>
	
	<query name="findQuotaByBatchId">
		<![CDATA[ 
			from HtlQuota quota where quota.ableSaleDate=? 
			and quota.quotaBatchId =? and quota.shareType =?
		]]>
	</query>
	
	<query name="lstAllQuotas">
		from HtlQuota quota where quota.hotelId=?
		 and quota.ableSaleDate > ?
	</query>
	
	<query name="queryQuotaWithoutWeek">
	   from HtlQuota quota where quota.quotaBatchId=? 
	      and quota.ableSaleDate between ? and ? order  by quota.ableSaleDate,quota.shareType
	</query>
	
	<query name="queryQuotaWithoutWeekEX">
		 from HtlQuota quota where quota.room.roomTypeId=? and quota.quotaType=? and quota.hotelId=? 
		   and quota.ableSaleDate between ? and ? order  by quota.ableSaleDate,quota.shareType
	</query>
	
	<query name="queryOutsideQuota">
		 from HtlRoom htlRoom where htlRoom.roomTypeId=? and htlRoom.hotelId=? 
		   and htlRoom.ableSaleDate between ? and ? order by htlRoom.ableSaleDate
	</query>

	<query name="queryTempQuota">
		 from  HtlTempQuota  htlTempRoom  where  htlTempRoom.roomId in 
		 (
			 select htlRoom.ID
			 from HtlRoom htlRoom where htlRoom.roomTypeId=? and htlRoom.hotelId=? 
			   and htlRoom.ableSaleDate between ? and ?
		 )
		 order by  htlTempRoom.roomId
	</query>
	
	<query name="queryContrCuf">
		SELECT DISTINCT d.cutoffDay, q.quotaType, q.shareType, t.roomName
		           FROM HtlCutoffDayQuota d,
		                HtlQuota q,
		                HtlRoom r,
		                HtlRoomtype t
		          WHERE t.hotelID = ?
		            AND t.active = '1'
		            and r.contractId = ?
		            AND r.roomTypeId = t.ID
		            AND q.room.ID = r.ID
		            AND d.quota.ID = q.ID
		       ORDER BY t.roomName, q.quotaType, q.shareType, d.cutoffDay			
	</query>	
	
	<query name="queryByContractId">
		from HtlQuota quota where quota.contractId=?		 
	</query>
	
	
</hibernate-mapping>
