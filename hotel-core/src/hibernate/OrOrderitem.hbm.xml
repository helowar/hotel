<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<!-- 
    Mapping file autogenerated by MyEclipse - Hibernate Tools
-->
<hibernate-mapping package="com.mangocity.hotel.order.persistence">
   <class name="OrOrderItem" table="OR_ORDERITEM" lazy="false"   dynamic-insert="true" dynamic-update="true" select-before-update="true">
   	<id name="ID">
			<generator class="sequence">
				<param name="sequence">seq_order_orderitem</param>
			</generator>
	</id>          
 
         <property name="night" />
         <property name="roomState" />
         <property name="quantity" />
         <property name="orderState" />
         <property name="firstNight" />         
         <property name="createTime" />
	 	 <property name="notes" />
         <property name="hisNo" column="itemsIdLink" />
         <property name="quotaCantReturn" column="includeService" />         
         <property name="orderItemsType" />
         <property name="settlement" />
         <property name="settlementDate" />   
         <property name="isConfirm" />                    
         <property name="quotaType" />


         <property name="salePrice" />                   
         <property name="basePrice" />

         <property name="marketPrice" />


     	 <property name="commission" />
     	 <property name="serviceFee" />
         <property name="breakfast" />
         <property name="breakfastNum" />
         <property name="breakfastWay" />
         <property name="breakfastPrice" />
   
         <property name="auditState" />
         <property name="roomNo" />


         <property name="notesMan" />     
         <property name="noteTime" />
         <property name="noteResult" />
         <property name="dayIndex" />
         <property name="roomIndex" />                  
         <property name="hotelId" />       
              
                      
         <property name="show" />          
         <property name="auditType" />                                
         <property name="lastNight" />     
         <property name="quotaPattern" />                            
         <property name="fellowName" /> 
         
         <property name="otherTax" />                            
         <property name="includeOtherTax" /> 
         
         <property name="includeNetFee" />
         
         <property name="netFee" />
         <property name="hasTaxFee" />
         <property name="taxFee" />
         <property name="includeService" column="hasServiceFee" />
         <property name="tmcPrice" column="TMCPRICE" />
        
         
         <!-- 配额改造 -->
         <property name="quotaholder"/>
         <property name="quotashare"/>
         <!-- 每间房的优惠立减金额 V2.9.3.1 add by chenjiajie 2009-10-15 -->
         <property name="favourableAmount"/>	 
         
   <!-- B2B代理 add by shengwei.zuo 2010-1-13  begin-->
         
         <!-- 代理 佣金-->
         <property name="agentComission" column="AGENT_COMISSION" />
         
         <!-- 代理佣金价-->
         <property name="agentComissionPrice" column="AGENT_COMISSION_PRICE" />
         
         <!-- 代理佣金率-->
         <property name="agentComissionRate" column="AGENT_COMISSION_RATE" />
         
         <!-- 佣金税率-->
         <property name="commTax" column="COMM_TAX" />
         
         <!-- 无用字段，从B2B代理开始，用来表示 佣金类型  2010-1-13-->
         <property name="comissionType" column="includebreakfast" />
         
         <!-- 无用字段，从B2B代理开始，用来表示 佣金类型对应的值  2010-1-13-->
         <property name="comissionTypeValue" column="breakfastway" />
          
           <!-- 显示在代理系统给代理看的 代理 佣金-->
         <property name="agentReadComission" column="AGENT_READ_COMISSION" />
         
         <!-- 显示在代理系统给代理看的代理佣金价-->
         <property name="agentReadComissionPrice" column="AGENT_READ_COMISSION_PRICE" />
         
         <!-- 显示在代理系统给代理看的代理佣金率-->
         <property name="agentReadComissionRate" column="AGENT_READ_COMISSION_RATE" />
   <!-- B2B代理 add by shengwei.zuo 2010-1-13  end-->
         
         <!-- 现金返还金额 add by linpeng.fang -->
         <property name="cashReturnAmount"/>
         
		<!-- 和OrOrder关联 -->
		<many-to-one name="order"
			class="OrOrder"
			column="orderId" 
			cascade="save-update"
			unique="true"/>           

		<!-- 和OrDailyAudit关联 -->
		<many-to-one name="audit"
			class="OrDailyAudit"
			column="auditId" 
			cascade="save-update"
			unique="true"/>     
         

    </class>

	<!-- 查询日审订单明细 -->   
	<query name="hQueryOrder_item1">
		<![CDATA[ 
		from OrOrderItem a 
		where 
			a.hotelId = ?
			and a.night = ?
			and a.show != 1
		order by 
			a.ID				
		
		]]>
	</query>  
	<!-- 查询日审订单明细房间号 -->   
	<query name="hQueryOrder_itemRoom1">
		<![CDATA[ 
		from OrOrderItem a 
		where 
			a.hotelId = ?
			and a.night = ? 
			and exists (select b.night from OrOrderItem b where b.night = ? and a.order.ID=b.order.ID and b.show != 1) 
		order by 
			a.ID			
		]]>
	</query>
	<!-- 查询日审订单明细 日审结果 -->   
	<query name="hQueryOrder_itemAudit1">
		<![CDATA[ 
		from OrOrderItem a 
		where 
			a.order.ID = ?
		order by 
			a.ID			
		]]>
	</query>	 
	<!-- 查询日审订单明细 日审结果 -->   
	<query name="hQueryOrder_itemDate1">
		<![CDATA[ 
		from OrOrderItem a 
		where 
			a.order.ID = ?
			and a.night = ? 
		order by 
			a.ID			
		]]>
	</query>	

	<!-- 查询日审订单明细 操作明晰 -->   
	<query name="hQueryOrder_ItemState1">
		<![CDATA[ 
		from OrOrderItem a 
		where 
			a.order.ID = ?
			and a.night = ? 
			and a.roomIndex = ?
		order by 
			a.ID			
		]]>
	</query>	
	
	<!-- 查询日审订单明细 操作明晰 -->   
	<query name="hQueryOrder_ItemShow1">
		<![CDATA[ 
		from OrOrderItem a 
		where 
			a.order.ID = ?
			and a.night > ? 
		order by 
			a.ID			
		]]>
	</query>		
	
	<!-- 查询日审订单明细 -->   
	<query name="hQueryOrder_ItemNum1">
		<![CDATA[ 
		from OrOrderItem a 
		where 
			a.hotelId = ?
			and a.night = ? 
			and a.roomIndex = ?
		order by 
			a.ID			
		]]>
	</query>

	
	
		<!-- 查询订单明细排除红单，附加单,并分组-->
	<!-- 
	<sql-query name="hQueryOrderItemByFaxGroup"><return alias="orderItem" class="com.mangocity.hotel.order.constant.OrderItemGroupBy"/>		
			select          night as {orderItem.night},
			               count(*) as {orderItem.QuantityByNight}, 
			       avg(baseprice) as {orderItem.basepriceByAvg},
			       avg(saleprice) as {orderItem.salepriceByAvg} 
            from Or_OrderItem  
            where orderitemstype=1 and orderid= :orderid     
             group by night   
            order by night
	</sql-query>
	
	-->

	
	
	  
</hibernate-mapping>
